# تصميم أداة مساعدة لتوليد خرائط الأدوات (Gadget Maps)

## 1. الغرض
تهدف هذه الأداة إلى تبسيط وتسريع عملية إنشاء وتحديث خرائط الأدوات (gadget maps) المستخدمة في سلاسل ROP/JOP ضمن مشروع `psfree-lapse`. بدلاً من التعديل اليدوي لملفات JavaScript (مثل `800.mjs`)، ستقوم هذه الأداة بتوليد كود JavaScript اللازم لتعريف `Map` الأدوات بناءً على مدخلات محددة.

## 2. المدخلات

ستقبل الأداة المدخلات بإحدى الطريقتين (أو كليهما في مراحل متقدمة):

*   **ملف نصي بسيط:** ملف يحتوي على قائمة من الأدوات، حيث كل سطر يمثل أداة واحدة بالتنسيق التالي:
    `"<سلسلة_التعليمة_للأداة>" : <الإزاحة_السداسية_عشرية>`
    مثال:
    `"pop rax; ret" : 0x0000000000035a1b`
    `"mov rax, qword ptr [rax]; ret" : 0x000000000002dc62`
*   **(مستقبلاً) مخرجات من أدوات تحليل ثنائي:** يمكن تكييف الأداة لتقرأ مخرجات من أدوات مثل ROPgadget، Ghidra، أو IDA Pro بعد معالجتها.

## 3. المخرجات

ستقوم الأداة بتوليد خرج نصي يمثل تعريف كائن `Map` في JavaScript، جاهز للنسخ واللصق في ملفات `.mjs` الخاصة بالمشروع. يجب أن يتبع التنسيق المستخدم في ملفات مثل `800.mjs`.

مثال على الخرج المتوقع لجزء من الخريطة:

```javascript
const webkit_gadget_offsets = new Map(Object.entries({
    'pop rax; ret' : 0x0000000000035a1b, // `58 c3` (مثال لتعليق يمكن إضافته يدويًا أو من الأداة)
    'mov rax, qword ptr [rax]; ret' : 0x000000000002dc62, // `48 8b 00 c3`
    // ... المزيد من الأدوات
}));
```

## 4. سير العمل الأساسي (المرحلة الأولى)

1.  **قراءة المدخلات:** ستقوم الأداة (في البداية سكربت بايثون) بقراءة الأدوات وإزاحاتها من ملف نصي محدد.
2.  **تنسيق البيانات:** تحويل البيانات المقروءة إلى هيكل مناسب.
3.  **توليد كود JavaScript:** إنشاء السلسلة النصية التي تمثل كود `Map` في JavaScript.
4.  **عرض/حفظ الخرج:** طباعة الكود المولد إلى الطرفية أو حفظه في ملف.

## 5. التقنيات المقترحة (المرحلة الأولى)

*   **لغة البرمجة:** Python لسهولة التعامل مع النصوص والملفات.

## 6. التوسعات المستقبلية

*   دعم قراءة مخرجات أدوات التحليل الثنائي مباشرة.
*   إمكانية تحديث ملفات `.mjs` الموجودة مباشرة (مع أخذ الحيطة والحذر).
*   إضافة واجهة مستخدم بسيطة (CLI أو واجهة رسومية).
*   التحقق من صحة الإزاحات أو تنسيق الأدوات.
*   إمكانية إضافة تعليقات تلقائية بناءً على نوع الأداة أو مصدرها.

